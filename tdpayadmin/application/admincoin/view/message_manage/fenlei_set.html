
<style>
	body .card .card-header .add-btn{
		position: absolute;
		right:30px;
		top:10px;
		font-size: 14px;
		line-height: 23px;
		padding: 5px 23px;
		width:auto;
		border-radius: 4px;
		height: auto;
		border:0;
	}
	/*禁用按钮*/
	.badge-secondary {
		background-color: #a2a3a5;
	}
	/*单选按钮*/
	.minimal{
		position:relative;
		top:2px;
	}
</style>
<section class="section">
	
	<div class="row">
		<div class="col-lg-12">
			<div class="card">
				<div class="card-header">
					<h4>分类管理</h4>
					<button type="submit" class="btn btn-primary mt-1 mb-0 add-btn" data-toggle="modal" data-target="#addModal">添加分类</button>
				</div>
				<div class="card-body">
				    
					<div class="table-responsive">
					<table id="example" class="table table-striped table-bordered border-t0 text-nowrap w-100" >
						<thead>
							<tr>
								<th class="wd-15p">ID</th>								
								<th class="wd-20p">分类名称</th>
								<th class="wd-15p">添加时间</th>
								<th class="wd-10p">排序</th>								
								<!-- <th class="wd-25p">状态</th>								 -->
								<th class="wd-25p">操作</th>
							</tr>
						</thead>
						<tbody>
							{foreach $list as $val}
							<tr>
								<td>{$val.class_id}</td>								
								<td>{$val.class_name}</td>
								<td>{$val.create_time}</td>
								<td>{$val.sort}</td>								
								<!-- <td><div class="badge badge-secondary">禁用</div></td> -->
								<td>
									<a class="btn btn-action btn-primary editBtn"  data-toggle="modal" data-target="#editModal" data-val="{$val.class_id}" id="edit">编辑</a>
									<a class="btn btn-action btn-danger del" data-val="{$val.class_id}">删除</a>
								</td>
							</tr>
							{/foreach}
				        </tbody>
					</table>
				</div>
				<!-- 分页 -->
				<!-- <div class="row">
					<div class="col-sm-12 col-md-5">
						<div class="dataTables_info" id="example_info" role="status" aria-live="polite">共<span>100</span>条</div>
					</div>
					<div class="col-sm-12 col-md-7">
						<div class="dataTables_paginate paging_simple_numbers text-right" >
							<ul class="pagination" style="justify-content: flex-end;">
								<li class="paginate_button page-item previous disabled" >
									<a aria-controls="example" data-dt-idx="0" tabindex="0" class="page-link">上一页</a>
								</li>
								<li class="paginate_button page-item active">
									<a aria-controls="example" data-dt-idx="1" tabindex="0" class="page-link">1</a>
								</li>
								<li class="page-item ">
									<a  aria-controls="example" data-dt-idx="2" tabindex="0" class="page-link">2</a>
								</li>
								<li class="paginate_button page-item ">
									<a aria-controls="example" data-dt-idx="3" tabindex="0" class="page-link">3</a>
								</li>
								<li class="paginate_button page-item ">
									<a aria-controls="example" data-dt-idx="4" tabindex="0" class="page-link">4</a>
								</li>
								<li class="paginate_button page-item ">
									<a aria-controls="example" data-dt-idx="5" tabindex="0" class="page-link">5</a>
								</li>
								<li class="paginate_button page-item next" id="example_next">
									<a aria-controls="example" data-dt-idx="6" tabindex="0" class="page-link">下一页</a>
								</li>
							</ul>
						</div>
					</div>
				</div> -->
				{$list|raw}
			</div>
		</div>
	</div>
</section>
<!-- 编辑弹框 -->
<div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="exampleModal1" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="example-Modal1">编辑分类</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">×</span>
				</button>
			</div>
			<div class="modal-body">				
				<div class="form-group row">
					<!-- <label class="col-md-3 col-form-label">ID</label> -->
					<div class="col-md-8">
						<input type="hidden" class="form-control" value="001" id="id">
					</div>
				</div>
				<div class="form-group row">
					<label class="col-md-3 col-form-label">类别名</label>
					<div class="col-md-8">
						<input type="text" class="form-control" value="新闻咨询" id="className">
					</div>
				</div>
				<div class="form-group row">
					<label class="col-md-3 col-form-label">排序</label>
					<div class="col-md-8">
						<input type="text" class="form-control" value="14" id="sort">
					</div>
				</div>				
				<!-- <div class="form-group row">
					<label class="col-md-3 col-form-label">状态</label>
					<div class="col-md-8">
						<label style="margin-right:30px;">
							<input type="radio" name="r1" class="minimal" checked="">
							<span>启用</span>
						</label>
						<label>
							<input type="radio" name="r1" class="minimal">
							<span>禁用</span>
						</label>
					</div>
				</div>	 -->
			</div>			
			<div class="modal-footer">
				<button type="button" class="btn btn-outline-primary" data-dismiss="modal">取消</button>
				<button type="button" class="btn btn-primary" data-dismiss="modal" id="editTo">确定</button>
			</div>
		</div>
	</div>
</div>

<!-- 添加弹框 -->
<div class="modal fade" id="addModal" tabindex="-1" role="dialog" aria-labelledby="exampleModal2" aria-hidden="true">
	<div class="modal-dialog" role="document">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="example-Modal2">添加分类</h5>
				<button type="button" class="close" data-dismiss="modal" aria-label="Close">
					<span aria-hidden="true">×</span>
				</button>
			</div>
			<div class="modal-body">				
				<!-- <div class="form-group row">
					<label class="col-md-3 col-form-label">ID</label>
					<div class="col-md-8">
						<input type="text" class="form-control" name="id" value="">
					</div>
				</div> -->
				<div class="form-group row">
					<label class="col-md-3 col-form-label">分类名称</label>
					<div class="col-md-8">
						<input type="text" class="form-control" name="class_name" value="">
					</div>
				</div>
				<div class="form-group row">
					<label class="col-md-3 col-form-label">排序</label>
					<div class="col-md-8">
						<input type="text" class="form-control" name="sort" value="">
					</div>
				</div>				
				<!-- <div class="form-group row">
					<label class="col-md-3 col-form-label">状态</label>
					<div class="col-md-8">
						<label style="margin-right:30px;">
							<input type="radio" name="r1" class="minimal" checked="">
							<span>启用</span>
						</label>
						<label>
							<input type="radio" name="r1" class="minimal">
							<span>禁用</span>
						</label>
					</div>
				</div>	 -->
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-outline-primary" data-dismiss="modal">取消</button>
				<button type="button" class="btn btn-primary" data-dismiss="modal" id="add">确定</button>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">
	 /*分页*/
	$('.pagination li a').click(function()
	{
		var href = this.href;
		$('.app-content').empty();
		$.ajax({
			type: "GET",
			url: href,
			success: function(data) {
				$('.app-content').append(data);
			}
		});
		return false;
	});

	/* 添加分类 */
	$('#add').click(function()
	{
		$('#addModal').modal('hide');
		var classname 	= $('input[name=class_name]').val();
		var sort 		= $('input[name=sort]').val();
		if(classname == ""){layer.msg('请输入分类名称');return}
		if(sort == ""){layer.msg('请输入排序');return}
		$.ajax({
			type: "POST",
			url: '/admincoin/Message_manage/class',
			data:{
	    			class_name:classname,
	    			sort:sort,
	    		},
			success: function(e) {
				if (e.code == 200) {
					layer.msg(e.msg);
					$('.app-content').empty();
					$.ajax({
						type: "GET",
						url: '/admincoin/Message_manage/class',
						success: function(data) {
							$('.app-content').append(data);
						}
					});
					return false;	
				}else{
					layer.msg(e.msg)
				}
			}
		});
		return false;
	});

	/* 编辑 */
	$('.editBtn').click(function()
	{
		var tdArray=[];
		var contents=$(this).closest("td").siblings("td");
		contents.each(function(){
			tdArray.push($(this).html());
		})

		$("#id").val(tdArray[0]);
		$("#className").val(tdArray[1]);
		$("#sort").val(tdArray[3]);
		
	});

	/* 提交编辑 */
	$('#editTo').click(function()
	{
		$('#editModal').modal('hide');
		var id 			= $('#id').val();
		var className 	= $('#className').val();
		var sort 		= $('#sort').val();
		if (!id) {layer.msg('id不能为空');return}
		if (!className) {layer.msg('分类名称不能为空');return}
		if (!sort) {layer.msg('排序不能为空');return}
		$.ajax({
			type: "POST",
			url: '/admincoin/Message_manage/editClass',
			data:{
	    			class_name:className,
	    			sort:sort,
	    			id:id
	    		},
			success: function(e) {
				if (e.code == 200) {
					layer.msg(e.msg);
					$('.app-content').empty();
					$.ajax({
						type: "GET",
						url: '/admincoin/Message_manage/class',
						success: function(data) {
							$('.app-content').append(data);
						}
					});
					return false;	
				}else{
					layer.msg(e.msg)
				}
			}
		});
		return false;
	});

	/* 删除 */
	$('.del').click(function()
	{
		var id 	= $(this).data('val');
		$.ajax({
			type: "GET",
			url: '/admincoin/Message_manage/delClass',
			data:{
	    			id:id
	    		},
			success: function(e) {
				if (e.code == 200) {
					layer.msg(e.msg);
					$('.app-content').empty();
					$.ajax({
						type: "GET",
						url: '/admincoin/Message_manage/class',
						success: function(data) {
							$('.app-content').append(data);
						}
					});
					return false;	
				}else{
					layer.msg(e.msg)
				}
			}
		});
		return false;
	});
</script>


		


